{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/add_item.css' %}">
{% endblock %}

{% block content %}
<div class="add-item-container">
  <h1 class="page-title">Add New Item</h1>

  <div class="inventory-card">
    <form method="POST" enctype="multipart/form-data" action="{% url 'add_item' %}">
      {% csrf_token %}
      
      <!-- Image Upload Section -->
      <div class="upload-box">
        <label for="image" class="upload-label" id="uploadLabel">
          <i class="bi bi-upload"></i> Upload Image
          <input type="file" id="image" name="image" accept="image/*" style="display: none;" required>
        </label>
        <img id="imagePreview" src="#" alt="Selected Image" style="display:none; max-width:150px; margin-top:10px; border-radius:8px;" />
      </div>

      <!-- Form Fields -->
      <div class="form-grid">
        <input type="date" name="date_added" required value="{{ today|date:'Y-m-d' }}">
        <input type="text" name="item" placeholder="Item Name" required>
        <input type="text" name="description" placeholder="Description" required>

        <input type="number" name="total_stock" placeholder="Total Stock" required>
        <input type="number" name="allocated_quantity" placeholder="Allocated Quantity" required>

        <select name="unit_of_quantity" required>
          <option value="" disabled selected>Unit of Quantity</option>
          <option value="pieces">Pieces</option>
          <option value="rolls">Rolls</option>
          <option value="meters">Meters</option>
        </select>
        <input type="text" name="part_no" placeholder="Part No.">
      </div>

      <!-- ✅ Serial Numbers Section (with modal trigger) -->
      <div class="serial-section">
        <div class="serial-header">
          <label>Add Serial Numbers</label>
          <button type="button" class="serial-btn" id="openSerialModal">+</button>
        </div>
        <!-- Hidden field to store serialized serial numbers -->
        <input type="hidden" id="serialHiddenInput" name="serial_numbers">
      </div>

      <!-- ✅ Modal for Serial Numbers -->
      <div id="serialModal" class="modal">
        <div class="modal-content">
          <h2>Serial Numbers</h2>
          <div id="serialFieldsContainer"></div>
          <div class="modal-actions">
            <button type="button" id="closeSerialModal" class="cancel-btn">Cancel</button>
            <button type="button" id="saveSerialNumbers" class="save-btn">Save</button>
          </div>
        </div>
      </div>

      <!-- Submit Section -->
      <div class="submit-section">
        <button type="submit" class="add-btn">
          <i class="bi bi-plus-square"></i> Add to Inventory
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ✅ Fixed Return Button -->
<a href="#" class="return-btn-fixed" onclick="history.back(); return false;">
  <i class="bi bi-arrow-left-circle"></i> Back to Overview
</a>

<script src="{% static 'js/add_item.js' %}"></script>
{% endblock %}