{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/item.css' %}">
<link rel="stylesheet" href="{% static 'css/update_item.css' %}">
{% endblock %}

{% block content %}
<div class="update-overlay">
  <div class="base-container update-container show-view" id="updateContainer">
    <h1 class="page-title">Update Item</h1>


    {% if messages %}
    <div class="message-container">
      {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
    {% endif %}
  

    <div class="inventory-card">
      <form method="POST" enctype="multipart/form-data" action="{% url 'update_item' item.id %}">
        {% csrf_token %}

        <div class="form-grid">
          <input type="date" name="date_added" required value="{{ today|date:'Y-m-d' }}">
          <input type="text" name="item" value="{{ item.item_name }}" readonly>
          <input type="text" name="description" value="{{ item.description }}" readonly>
          <input type="text" name="user" value="{{ request.user.username }}" readonly>
          <input type="text" name="location" value="{{ item.location }}" placeholder="Location">
          <input type="text" name="part_no" value="{{ item.part_no }}" placeholder="Part No.">
          <input type="text" name="remarks" value="{{ item.remarks }}" placeholder="Remarks">

          <div class="btn-pair">
            <input type="number" name="in" id="inField" placeholder="IN" min="0">
            <input type="number" name="out" id="outField" placeholder="OUT" min="0">
          </div>

          <input type="number" id="allocatedQuantity" name="allocated_quantity" placeholder="Allocate Stock" min="0">




          <input type="text" name="dr_no" id="drInput" placeholder="DR No." value="{{ item.dr_no }}" disabled>

          <input type="text" name="po_supplier" id="poSupplierField" value="{{ item.po_from_supplier }}" placeholder="P.O To Supplier">
          <input type="text" name="po_client" id="poClientField" value="{{ item.po_to_client }}" placeholder="P.O From Client">
        </div>
        
        <div class="serial-number-section" style="margin-top: 10px;">
          <button type="button" id="openSerialsBtn" class="add-btn secondary-btn">
            <i class="bi bi-plus-circle"></i> Manage Serials
          </button>
          <input type="hidden" name="serial_numbers" id="serialNumbersField">
        </div>

        <div class="submit-section">
          <button type="submit" class="add-btn update-submit-btn">
            <i class="bi bi-arrow-up-circle"></i> Update Item
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="base-container serial-modal-container hide-view" id="serialModal">
    <h3 id="serialModalTitle">Manage Serials</h3>

    <div class="content-layout">
        <div>
            <div class="serial-search-box" id="serialSearchBox">
                <input type="text" id="serialSearch" placeholder="Search serial number...">
            </div>

            <div id="serialInputsContainer"></div>
        </div>

        <div class="modal-actions serial-modal-actions">
            <button type="button" id="closeSerialsBtn" class="add-btn secondary-btn">Cancel</button>
            <button type="button" id="saveSerialsBtn" class="add-btn">Save Serials</button>
        </div>
    </div>
  </div>
</div>

<a href="{% url 'inventory' %}" class="return-btn-fixed">
  <i class="bi bi-arrow-left-circle"></i> Back to Overview
</a>

<!-- âœ… Pass Django data to JavaScript -->
<script>
  // Make available_serials accessible to external JS
  window.availableSerials = {{ available_serials|default:"[]"|safe }};
</script>

<!-- External JavaScript -->
<script src="{% static 'js/update_item.js' %}"></script>

{% endblock %}